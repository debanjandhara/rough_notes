### **System Layer (Architecture & Components)**
This section translates the functional features into a tangible architecture, defining the internal and external systems, individual components, and the infrastructure they will run on.

---

#### **Deliverable: System Context Diagram**

**Description:** This diagram provides a high-level view of the ArchitectPulse ecosystem. It illustrates the boundary of our system, showing how it interacts with its users and other external software systems. It answers the question: "Where does our system fit in the world?"

```mermaid
graph TD
    subgraph Users
        A[Legal Users  - (Admin, Lawyers)]
        B[E-commerce Users  - (Business Owner, Shopkeepers)]
    end

    subgraph ArchitectPulse System
        WebApp[Web Application  - (Single-Page App)]
        
        subgraph Backend Services
            API[API Gateway]
            Services[Modular Services  - (Auth, Legal, E-commerce, etc.)]
        end

        DB[(Primary Database  - PostgreSQL)]
        FS[(File Storage  - Amazon S3)]
    end

    subgraph External Systems
        Email[Email Service  - (e.g., AWS SES)]
        Ecom[External E-commerce Websites]
        WApp(WhatsApp Gateway  - <i>Future Integration</i>)
    end
    
    A & B -- HTTPS --> WebApp
    WebApp -- REST API Calls --> API
    API -- Routes Requests --> Services
    Services -- Reads/Writes --> DB
    Services -- Stores/Retrieves Files --> FS
    Services -- Sends Notifications --> Email
    Ecom -- Transaction Webhooks/API --> API
    Services -- Sends Messages --> WApp
```

**System Interactions Explained:**

*   **Users** interact with the **Web Application** through their browsers. All user-facing functionality is rendered here.
*   The **Web Application** is a client that communicates exclusively with our **API Gateway**, which serves as the single, secure entry point to the backend.
*   The **Backend Services** contain all the business logic. They are organized into independent modules to fulfill the BRD's core requirement.
*   The services persist business data in the **Primary Database** and store large files (like legal documents) in a separate **File Storage** system.
*   For outbound communication, the services integrate with an **Email Service** for notifications and will integrate with a **WhatsApp Gateway** in the future.
*   The system receives data from **External E-commerce Websites** via webhooks or API calls to automate transaction entry for the E-commerce module.

---

#### **Deliverable: Component Diagram (Internal Architecture)**

**Description:** This diagram "zooms in" on the backend services. It breaks down the monolithic concept of "the backend" into a modular, Service-Oriented Architecture (SOA). This architecture is fundamental to creating a flexible CRM that can be adapted for different clients (Legal vs. E-commerce) without rewriting the entire application.

```mermaid
graph TD
    subgraph Client-Facing
        WebApp[Web Application  - (React/Vue)]
    end

    subgraph Backend
        Gateway[API Gateway]

        subgraph Shared Core Services
            Auth[Authentication Service  - (Handles Users, Roles, JWTs)]
            Notify[Notification Service  - (Manages Email/Push)]
            Tasks[Task Service  - (Generic Task Management)]
        end

        subgraph Business Logic Modules
            Legal[Legal Service  - (Cases, Clients, Documents)]
            Ecom[E-commerce Service  - (Transactions, Products, Costs)]
            Commission[Commission Engine  - (Runs Complex Calculations)]
        end

        subgraph Data Persistence Layer
            Database[(PostgreSQL DB  - w/ Schemas per Service)]
            FileStore[(Amazon S3)]
            MsgQueue[Message Queue  - (e.g., RabbitMQ/SQS)]
        end
    end

    %% Connections
    WebApp -- API Calls --> Gateway

    Gateway -- Routes to --> Auth
    Gateway -- Routes to --> Tasks
    Gateway -- Routes to --> Legal
    Gateway -- Routes to --> Ecom

    Legal -- Uses --> Auth
    Ecom -- Uses --> Auth
    Tasks -- Uses --> Auth

    Legal -- Calls --> Notify
    Ecom -- Calls --> Notify
    Commission -- Calls --> Notify

    Legal -- Reads/Writes --> Database
    Ecom -- Reads/Writes --> Database
    Auth -- Reads/Writes --> Database
    Tasks -- Reads/Writes --> Database
    Commission -- Reads/Writes --> Database
    
    Legal -- Manages Files in --> FileStore
    
    Ecom -- Publishes 'SaleCreated' event --> MsgQueue
    MsgQueue -- Delivers event to --> Commission
```

**Component Breakdown:**

*   **API Gateway:** The front door to the backend. It handles request routing, authentication validation, and rate limiting, protecting the services behind it.
*   **Shared Core Services:**
    *   **Authentication Service:** Manages everything about usersâ€”who they are, what their role is, and whether they are allowed to access the system.
    *   **Notification Service:** A centralized service that other modules can use to send notifications without needing to know the specifics of email or push delivery.
    *   **Task Service:** A simple, reusable module for handling the to-do list functionality seen in the mockup.
*   **Business Logic Modules:**
    *   **Legal Service:** A self-contained module that encapsulates all business logic for the legal firm client. It knows about cases, clients, and document assignments.
    *   **E-commerce Service:** A self-contained module for the e-commerce client. It handles the creation of transactions and products.
    *   **Commission Engine:** A highly specialized service. It is **decoupled** from the E-commerce Service via a **Message Queue**. When a sale is made, the E-commerce service quickly records it and publishes an event. The Commission Engine picks up this event and performs the potentially slow and complex commission calculations in the background, ensuring the user experience remains fast.
*   **Data Persistence Layer:**
    *   **PostgreSQL Database:** A single database instance is used for simplicity, but it's logically partitioned with **schemas** (e.g., `legal`, `ecommerce`, `core`) to keep each service's data isolated.
    *   **Amazon S3:** Used for storing unstructured data like PDF documents, ensuring the database is not bloated with large files.

---

#### **Deliverable: Infrastructure Choices**

**Description:** Concrete decisions on the cloud platform, tools, and technologies that will be used to build, deploy, and run the ArchitectPulse system.

| Category                | Choice & Justification                                                                                                                                                                                                                                                           |
| ----------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **Cloud Provider**      | **Amazon Web Services (AWS)**. <br/>*Justification:* AWS is the market leader with a mature and comprehensive suite of managed services that directly map to our component needs (e.g., S3 for files, RDS for database, EKS for compute). This reduces operational burden and accelerates development.         |
| **Compute & Hosting**     | **Docker Containers orchestrated by Amazon EKS (Kubernetes Service).** <br/>*Justification:* Our service-oriented architecture is ideal for containerization. Docker ensures consistency between development and production. Kubernetes provides robust orchestration, auto-scaling, and self-healing for our many services. |
| **CI/CD Pipeline**      | **GitHub + GitHub Actions.** <br/>*Justification:* A tightly integrated solution for version control and automation. The pipeline will automate testing, building Docker images, pushing them to a registry (Amazon ECR), and deploying them to the Kubernetes cluster on every merge to the main branch. |
| **Primary Database**      | **Amazon RDS for PostgreSQL.** <br/>*Justification:* PostgreSQL is a powerful open-source relational database perfect for our structured data. Using the managed RDS service offloads complex administrative tasks like backups, patching, and replication, allowing the team to focus on building features. |
| **File & Document Storage** | **Amazon S3 (Simple Storage Service).** <br/>*Justification:* The industry standard for durable, scalable, and cost-effective object storage. It is the perfect choice for storing the legal documents required by the Legal module.                                              |
| **Authentication Provider** | **Internal Authentication Service (using JWTs).** <br/>*Justification:* For the initial build, a custom service provides full control. **Future Roadmap:** Migrate to a managed service like **AWS Cognito** or **Auth0** to offload security complexity and easily add features like MFA and social logins. |
| **API Gateway**           | **Amazon API Gateway.** <br/>*Justification:* A fully managed, scalable service that seamlessly integrates with our backend services running on AWS. It handles routing, security policies, and monitoring with minimal setup.                                          |
| **Message Queue**         | **Amazon SQS (Simple Queue Service).** <br/>*Justification:* A reliable, highly scalable managed queue service. It is perfect for decoupling the Commission Engine from the E-commerce Service, ensuring high performance and resilience for the transaction processing workflow. |
